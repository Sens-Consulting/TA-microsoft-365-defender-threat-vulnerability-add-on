        <dashboard version="2" theme="dark">
            <label>Vulnerabilities System overview</label>
            <description></description>
            <definition><![CDATA[{"visualizations":{"viz_single_1":{"type":"splunk.singlevalue","options":{"drilldown":"none","refresh.display":"progressbar","backgroundColor":"transparent"},"dataSources":{"primary":"ds_search_3"},"title":""},"viz_single_2":{"type":"splunk.singlevalue","options":{"drilldown":"none","refresh.display":"progressbar","backgroundColor":"transparent"},"dataSources":{"primary":"ds_search_4"},"title":""},"viz_single_3":{"type":"splunk.singlevalue","options":{"drilldown":"none","numberPrecision":1,"refresh.display":"progressbar","majorColor":"#ffffff","backgroundColor":"transparent","sparklineDisplay":"off","unit":"/ 10"},"dataSources":{"primary":"ds_search_5"},"title":"","context":{"convertedColorRange":[{"from":7,"value":"#dc4e41"},{"from":5,"to":7,"value":"#f8be34"},{"from":3,"to":5,"value":"#006d9c"},{"to":3,"value":"#53a051"}]}},"viz_chart_1":{"type":"viz.bar","options":{"axisTitleX.visibility":"collapsed","axisTitleY.visibility":"visible","drilldown":"none","legend.placement":"none","refresh.display":"progressbar","backgroundColor":"#EBEBEB","fontColor":"#353535","foregroundColor":"#14465A","gridLinesX.showMajorLines":false,"gridLinesY.showMajorLines":false,"seriesColors":["#14465A","#1991AF"]},"dataSources":{"primary":"ds_search_7"},"title":""},"viz_chart_2":{"type":"viz.line","options":{"axisLabelsX.majorLabelStyle.overflowMode":"ellipsisNone","axisLabelsX.majorLabelStyle.rotation":0,"axisTitleX.visibility":"visible","axisTitleY.visibility":"visible","axisTitleY2.visibility":"visible","axisX.abbreviation":"none","axisX.scale":"linear","axisY.abbreviation":"none","axisY.scale":"linear","axisY2.abbreviation":"none","chart.bubbleMaximumSize":50,"chart.bubbleMinimumSize":10,"chart.bubbleSizeBy":"area","chart.nullValueMode":"connect","chart.overlayFields":"Fixed","chart.showDataLabels":"none","chart.sliceCollapsingThreshold":0.01,"chart.stackMode":"default","chart.style":"shiny","drilldown":"none","legend.labelStyle.overflowMode":"ellipsisMiddle","legend.mode":"standard","legend.placement":"bottom","lineWidth":2,"refresh.display":"progressbar","trellis.enabled":0,"trellis.scales.shared":1,"trellis.size":"medium","backgroundColor":"#AAD1E1","fontColor":"#353535","gridLinesX.showMajorLines":false,"fieldColors":{"Active":"#D25528","Fixed":"#1991AF"},"field DashStyle":"shortDash"},"dataSources":{"primary":"ds_search_8"},"title":""},"viz_chart_3":{"type":"viz.scatter","options":{"axisLabelsX.majorLabelStyle.overflowMode":"ellipsisNone","axisLabelsX.majorLabelStyle.rotation":0,"axisTitleX.visibility":"visible","axisTitleY.visibility":"visible","axisTitleY2.visibility":"visible","axisX.abbreviation":"none","axisX.scale":"linear","axisY.abbreviation":"none","axisY.scale":"linear","axisY2.abbreviation":"none","axisY2.enabled":0,"axisY2.scale":"inherit","chart.bubbleMaximumSize":50,"chart.bubbleMinimumSize":10,"chart.bubbleSizeBy":"area","chart.nullValueMode":"gaps","chart.showDataLabels":"none","chart.sliceCollapsingThreshold":0.01,"chart.stackMode":"default","chart.style":"shiny","drilldown":"none","layout.splitSeries":0,"layout.splitSeries.allowIndependentYRanges":0,"legend.labelStyle.overflowMode":"ellipsisMiddle","legend.mode":"standard","legend.placement":"none","lineWidth":2,"refresh.display":"progressbar","trellis.enabled":0,"trellis.scales.shared":1,"trellis.size":"medium","backgroundColor":"#EBEBEB","fontColor":"#353535","gridLinesX.showMajorLines":false,"fieldColors":{"Yes":"#D25528","No":"#EB9673"},"chart.markerSize":3},"dataSources":{"primary":"ds_search_9"},"title":"","encoding":{"x":"primary[1]","y":"primary[2]","category":"primary[0]"}},"viz_PHMaq67S":{"type":"viz.ellipse","options":{"stroke":"#1991AF","fill":"#1991AF"}},"viz_ApmTknKv":{"type":"viz.text","options":{"content":"The system has","fontFamily":"Helvetica","textColor":"#14465A"}},"viz_jVun8oq7":{"type":"viz.ellipse","options":{"stroke":"#14465A","fill":"#14465A"}},"viz_V0EoGeF2":{"type":"viz.text","options":{"content":"devices with a total of","fontFamily":"Helvetica","textColor":"#14465A"}},"viz_qtt9sSve":{"type":"viz.text","options":{"content":"vulnerabilities.","fontFamily":"Helvetica","textColor":"#14465A"}},"viz_BwW1nKBB":{"type":"viz.text","options":{"content":"The average system security score is","fontFamily":"Helvetica","textColor":"#14465A"}},"viz_iiBphpWB":{"type":"viz.ellipse","options":{"stroke":"#EB9673","fill":"#EB9673"}},"viz_k8leb0BH":{"type":"viz.text","options":{"content":"Top vulnerable systems","fontWeight":"bold","backgroundColor":"#EBEBEB","textColor":"#14465A"}},"viz_9NspBQHy":{"type":"viz.text","options":{"content":"Vulnerabilities over time","fontWeight":"bold","textColor":"#14465A"}},"viz_4Ro7us1M":{"type":"viz.text","options":{"content":"Active Vulnerabilities overview","fontWeight":"bold","backgroundColor":"#EBEBEB","textColor":"#14465A"}}},"dataSources":{"ds_search_1":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search\n| `get_system_from_machinetags(.*system.*)`\n| fields + machine_system_tags \n| mvexpand machine_system_tags \n| stats count by machine_system_tags\n| where match(machine_system_tags,\"system\")\n| fields - count","queryParameters":{"earliest":"-24h@h","latest":"now"}}},"ds_search_2":{"type":"ds.search","options":{"query":"| inputlookup ms_defender_endpoint_machines_assets.csv\n| eval machine_system_tags = split(category, \"|\") \n| eval system = mvindex(machine_system_tags, mvfind(machine_system_tags,\".*.*system.*.*\"))\n| search system=\"*$token_system$*\"\n| eval device=nt_host","queryParameters":{"earliest":"-7d@h","latest":"now"}}},"ds_search_3":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search\n| `get_system_from_machinetags(.*system.*)`\n| search system=\"*$token_system$*\" Vulnerabilities.dest=\"$token_device$\"\n| stats dc(Vulnerabilities.dest)","queryParameters":{"earliest":"$token_time.earliest$","latest":"$token_time.latest$"}}},"ds_search_4":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search\n| `get_system_from_machinetags(.*system.*)`\n| search system=\"*$token_system$*\" Vulnerabilities.dest=\"$token_device$\"\n| stats dc(Vulnerabilities.cve)","queryParameters":{"earliest":"$token_time.earliest$","latest":"$token_time.latest$"}}},"ds_search_5":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search\n| `get_system_from_machinetags(.*system.*)`\n| search system=\"*$token_system$*\" Vulnerabilities.dest=\"$token_device$\"\n| dedup Vulnerabilities.dest, Vulnerabilities.cve\n| stats avg(Vulnerabilities.cvss) as avg_cvss_score\n| eval avg_cvss_score=round(avg_cvss_score,1)","queryParameters":{"earliest":"$token_time.earliest$","latest":"$token_time.latest$"}}},"ds_search_6":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search \n| `get_system_from_machinetags(.*system.*)` \n| search system=\"*$token_system$*\" Vulnerabilities.dest=\"$token_device$\"\n| rename Vulnerabilities.* as *\n| stats latest(cvss) as cvss, latest(exposure_level) as exposure_level by dest, cve\n\n| stats values(exposure_level) as \"Exposure level\", dc(cve) as \"Unique vulnerabilities\", sum(cvss) as total_cvss, avg(cvss) as avg_cvss by dest \n| eval \"Total Cvss score\"=round(total_cvss,1), \"Avg Cvss score\"=round(avg_cvss,1) \n| rename dest as Device \n| sort - total_cvss \n| fields - total_cvss, avg_cvss","queryParameters":{"earliest":"$token_time.earliest$","latest":"$token_time.latest$"}}},"ds_search_7":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search\n| `get_system_from_machinetags(.*system.*)`\n| stats dc(Vulnerabilities.cve) as Vulnerabilities by system\n| sort - Vulnerabilities","queryParameters":{"earliest":"$token_time.earliest$","latest":"$token_time.latest$"}}},"ds_search_8":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search \n| `get_system_from_machinetags(.*system.*)`\n| search system=\"*$token_system$*\" Vulnerabilities.dest=\"$token_device$\"\n| spath\n| eval status=ifnull(status,\"Active\")\n| timechart span=1d dc(Vulnerabilities.cve) as cveid by status\n| eval Active=if(Active==0,null(),Active)\n| filldown Active\n| table _time, Active, Fixed","queryParameters":{"earliest":"-30d@d","latest":"now"}}},"ds_search_9":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search \n| `get_system_from_machinetags(.*system.*)` \n| search system=\"*$token_system$*\" Vulnerabilities.dest=\"$token_device$\"\n| rename Vulnerabilities.* as *\n| stats latest(cvss) as cvss, latest(exposure_level) as exposure_level by dest, cve\n\n| stats latest(cvss) as \"CVSS score\", count as \"Devices with Cve\" by cve\n| eval cve=upper(cve)\n| lookup cve_description.csv CveId as cve OUTPUT IsExploitAvailable\n| rename cve as CVE\n| eval IsExploitAvailable=if(IsExploitAvailable=0,\"No\",\"Yes\")\n| eval CVE = replace(CVE,\"(CVE|TVM)-(\\d+)-(\\d+)\",\"\\2.\\3\") \n| fields IsExploitAvailable  \"CVSS score\" \"Devices with Cve\" CVE","queryParameters":{"earliest":"-30d@d","latest":"now"}}},"ds_search_10":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search\n| `get_system_from_machinetags(.*system.*)`\n| search system=\"*$token_system$*\" Vulnerabilities.dest=\"$token_device$\"\n```CveId in lookup is uppercase``` \n| eval CveId=upper('Vulnerabilities.cve')\n| dedup CveId, Vulnerabilities.dest\n| lookup cve_description.csv CveId OUTPUT IsExploitAvailable, VulnerabilitySeverityLevel as Severity, VulnerabilityDescription as Description, LastModifiedTime, PublishedDate, RecommendedSecurityUpdateId\n| stats count as Occurences by CveId, IsExploitAvailable, Severity, PublishedDate, LastModifiedTime, RecommendedSecurityUpdateId, Description\n| table CveId, Occurences, Severity, IsExploitAvailable, Description\n| sort - Occurences","queryParameters":{"earliest":"$token_time.earliest$","latest":"$token_time.latest$"}}},"ds_dwaHCYgW_ds_search_3":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search\n| `get_system_from_machinetags(.*system.*)`\n| search system=\"*$token_system$*\" Vulnerabilities.dest=\"$token_device$\"\n| stats dc(Vulnerabilities.dest)","queryParameters":{"earliest":"$token_time.earliest$","latest":"$token_time.latest$"}}},"ds_bWxMl7Yy_ds_search_3":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search\n| `get_system_from_machinetags(.*system.*)`\n| search system=\"*$token_system$*\" Vulnerabilities.dest=\"$token_device$\"\n| stats dc(Vulnerabilities.dest)","queryParameters":{"earliest":"$token_time.earliest$","latest":"$token_time.latest$"}}},"ds_K5QZjKZ6_ds_search_5":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search\n| `get_system_from_machinetags(.*system.*)`\n| search system=\"*$token_system$*\" Vulnerabilities.dest=\"$token_device$\"\n| dedup Vulnerabilities.dest, Vulnerabilities.cve\n| stats avg(Vulnerabilities.cvss) as avg_cvss_score\n| eval avg_cvss_score=round(avg_cvss_score,1)","queryParameters":{"earliest":"$token_time.earliest$","latest":"$token_time.latest$"}}},"ds_oDNop84u_ds_search_3":{"type":"ds.search","options":{"query":"| datamodel Vulnerabilities search\n| `get_system_from_machinetags(.*system.*)`\n| search system=\"*$token_system$*\" Vulnerabilities.dest=\"$token_device$\"\n| stats dc(Vulnerabilities.dest)","queryParameters":{"earliest":"$token_time.earliest$","latest":"$token_time.latest$"}}}},"defaults":{"dataSources":{"ds.search":{"options":{"queryParameters":{}}}}},"inputs":{"input_1":{"type":"input.dropdown","title":"System","options":{"token":"token_system"},"encoding":{"value":"primary.machine_system_tags","label":"primary.machine_system_fixed"},"dataSources":{"primary":"ds_search_1"}},"input_2":{"type":"input.dropdown","title":"Device","options":{"token":"token_device","defaultValue":"*","items":[{"value":"*","label":"All"}]},"encoding":{"value":"primary.device","label":"primary.nt_host"},"dataSources":{"primary":"ds_search_2"}},"input_3":{"type":"input.timerange","title":"Time period","options":{"token":"token_time","defaultValue":"-7d@h,now"}}},"layout":{"type":"absolute","options":{"submitButton":false,"height":1200,"backgroundColor":"#AAD1E1","display":"auto-scale"},"structure":[{"item":"viz_chart_1","type":"block","position":{"x":0,"y":310,"w":1200,"h":250}},{"item":"viz_chart_2","type":"block","position":{"x":0,"y":610,"w":1200,"h":290}},{"item":"viz_chart_3","type":"block","position":{"x":0,"y":950,"w":1200,"h":250}},{"item":"viz_PHMaq67S","type":"block","position":{"x":200,"y":40,"w":90,"h":90}},{"item":"viz_single_1","type":"block","position":{"x":190,"y":40,"w":110,"h":90}},{"item":"viz_ApmTknKv","type":"block","position":{"x":10,"y":60,"w":180,"h":60}},{"item":"viz_jVun8oq7","type":"block","position":{"x":550,"y":20,"w":120,"h":120}},{"item":"viz_single_2","type":"block","position":{"x":540,"y":40,"w":140,"h":90}},{"item":"viz_V0EoGeF2","type":"block","position":{"x":300,"y":60,"w":250,"h":60}},{"item":"viz_qtt9sSve","type":"block","position":{"x":680,"y":60,"w":380,"h":60}},{"item":"viz_BwW1nKBB","type":"block","position":{"x":10,"y":160,"w":620,"h":60}},{"item":"viz_iiBphpWB","type":"block","position":{"x":440,"y":120,"w":130,"h":130}},{"item":"viz_single_3","type":"block","position":{"x":420,"y":110,"w":180,"h":150}},{"item":"viz_k8leb0BH","type":"block","position":{"x":0,"y":260,"w":1200,"h":50}},{"item":"viz_9NspBQHy","type":"block","position":{"x":0,"y":560,"w":1200,"h":50}},{"item":"viz_4Ro7us1M","type":"block","position":{"x":0,"y":900,"w":1200,"h":50}}],"globalInputs":["input_1","input_2","input_3"]},"description":"","title":"Vulnerabilities System overview"}]]></definition>
            <assets><![CDATA[{}]]></assets>
        </dashboard>